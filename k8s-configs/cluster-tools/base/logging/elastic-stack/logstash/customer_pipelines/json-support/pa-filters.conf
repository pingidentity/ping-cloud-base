filter {
  if ([kubernetes][container_name] =~ "pingaccess(-was)?(-admin)?") {
  ### Parse logs starting from log path.
      ### Parse json formatted logs
      json {
          source => "log"
          remove_field => "log"
          skip_on_invalid_json => true
      }
      if ([log_name] == "pingaccess") {
        mutate {
          add_field => {"log" => "/opt/out/instance/log/%{log_name}.log %{timestamp}| %{logLevel}| %{exchangeId}| %{className}| %{message}"}
          remove_field => ["logLevel", "exchangeId", "className", "message"]
        }
      }
      else if ([log_name] == "pingaccess_api_audit"){
        mutate {
          add_field => {"log" => "/opt/out/instance/log/pingaccess_api_audit.log %{timestamp}| %{exchangeId}| %{trackingId}| %{roundTripMS} ms| %{subject}| %{authMech}| %{client}| %{method}| %{requestUri}| %{responseCode}"}
          remove_field => ["exchangeId", "trackingId", "roundTripMS", "subject", "authMech", "client", "method", "requestUri", "responseCode", "contextMap"]
        }
      }
      else if ([log_name] == "pingaccess_engine_audit"){
        mutate {
          add_field => {"log" => "/opt/out/instance/log/pingaccess_engine_audit.log %{timestamp}| %{exchangeId}| %{trackingId}| %{roundTripMS}| %{proxyRoundTripMS}| %{resource}| %{subject}| %{authMech}| %{client}| %{method}| %{requestUri}| %{responseCode}| %{failedRuleType}| %{failedRuleName}| %{applicationName}| %{resourceName}| %{pathPrefix}"}
          remove_field => ["exchangeId", "trackingId", "roundTripMS", "proxyRoundTripMS", "resource", "subject", "authMech", "client", "method", "requestUri", "responseCode", "failedRuleType", "failedRuleName", "applicationName", "resourceName", "pathPrefix", "contextMap"]
        }
      }
      else if ([log_name] == "pingaccess_agent-audit"){
        mutate {
          add_field => {"log" => "/opt/out/instance/log/pingaccess_agent_audit.log %{timestamp}| %{exchangeId}| %{trackingId}| %{roundTripMS} ms| %{resource}| %{client}| %{method}| %{requestUri}| %{responseCode}| %{applicationName}| %{resourceName}| %{pathPrefix}"}
          remove_field => ["exchangeId", "trackingId", "roundTripMS", "resource", "client", "method", "requestUri", "responseCode", "applicationName", "resourceName", "pathPrefix"]
        }
      }
      else if ([log_name] == "pingaccess_sideband_client_audit"){
        mutate {
          add_field => {"log" => "/opt/out/instance/log/pingaccess_sideband_client_audit.log %{timestamp}| %{exchangeId}| %{trackingId}| %{roundTripMS} ms|  %{client}| %{method}| %{resource}| %{requestUri}| %{responseCode}| %{sidebandName}| %{sidebandDecision}"}
          remove_field => ["exchangeId", "trackingId", "roundTripMS", "client", "method", "resource", "requestUri", "responseCode", "sidebandName", "sidebandDecision"]
        }
      }
      else if ([log_name] == "pingaccess_sideband_audit") {
        mutate {
          add_field => {"log" => "/opt/out/instance/log/pingaccess_sideband_audit.log %{timestamp}| %{exchangeId}| %{trackingId}| %{roundTripMS} ms| %{resource}| %{client}| %{method}| %{requestUri}| %{responseCode}| %{applicationName}| %{resourceName}| %{pathPrefix}| %{sidebandName}"}
        }
      }
      else if ([log_name] == "upgrade") {
        mutate {
          add_field => {"log" => "/opt/out/instance/log/audit.log %{timestamp} %{logLevel} %{className}:%{position} - %{message}"}
          remove_field => ["logLevel", "className", "position", "message"]
        }
      }
      else if ([log_name] == "audit") {
        mutate {
          add_field => {"log" => "/opt/out/instance/log/audit.log %{message}"}
          remove_field => ["message"]
        }
      }
    }
}
