filter {
  if ([kubernetes][container_name] =~ "pingdirectory") {
  ### Parse logs starting from log path.
      ### Parse json formatted logs
      json {
          source => "log"
          remove_field => "log"
          skip_on_invalid_json => true
      }

      if ([logType] == "access") {
        if ([messageType] == "RESULT" and [operationType] == "SEARCH") {
          mutate {
            add_field => {"log" => "/opt/pingidentity/server/logs/%{logType} [%{timestamp}] %{operationType} %{messageType} instanceName=\"%{instanceName}\" threadID=%{threadID} conn=%{connectionID} op=%{operationID} msgID=%{messageID} requesterIP=\"%{requesterIP}\" requesterDN=\"%{requesterDN}\" usingAdminSessionWorkerThread=%{usingAdminSessionWorkerThread} base=\"%{baseDN}\" scope=%{scope} filter=\"%{filter}\" attrs=\"%{requestedAttributes}\" resultCode=%{resultCode} resultCodeName=\"%{resultCodeName}\" qtime=%{workQueueWaitTimeMillis} etime=%{processingTimeMillis} usedPrivileges=%{usedPrivileges} preAuthZUsedPrivileges=%{preAuthorizationUsedPrivileges} entriesReturned=%{entriesReturned}"}
            remove_field => ["operationType", "messageType", "instanceName", "threadID", "connectionID", "operationID", "messageID", "requesterIP", "requesterDN", "usingAdminSessionWorkerThread", "baseDN", "scope", "filter", "requestedAttributes", "resultCode", "resultCodeName", "workQueueWaitTimeMillis", "processingTimeMillis", "usedPrivileges", "preAuthorizationUsedPrivileges", "entriesReturned"]
          }
        }
        else if ([messageType] == "RESULT" and [operationType] == "BIND") {
          mutate {
            add_field => {"log" => "/opt/pingidentity/server/logs/%{logType} [%{timestamp}] %{operationType} %{messageType} instanceName=\"%{instanceName}\" threadID=%{threadID} conn=%{connectionID} op=%{operationID} msgID=%{messageID} requesterIP=\"%{requesterIP}\" usingAdminSessionWorkerThread=%{usingAdminSessionWorkerThread} version=\"%{version}\" dn=\"%{dn}\" authType=\"%{authType}\" resultCode=%{resultCode} resultCodeName=\"%{resultCodeName}\" qtime=%{workQueueWaitTimeMillis} etime=%{processingTimeMillis} authDN=\"%{authenticationDN}\" clientConnectionPolicy=\"%{clientConnectionPolicy}\""}
            remove_field => ["operationType", "messageType", "instanceName", "threadID", "connectionID", "operationID", "messageID", "requesterIP", "usingAdminSessionWorkerThread", "version", "dn", "authType", "resultCode", "resultCodeName", "workQueueWaitTimeMillis", "processingTimeMillis", "authenticationDN", "clientConnectionPolicy"]
          }
        }
        else if ([messageType] == "RESULT" and [operationType] == "EXTENDED") {
          mutate {
            add_field => {"log" => "/opt/pingidentity/server/logs/%{logType} [%{timestamp}] %{operationType} %{messageType} instanceName=\"%{instanceName}\" threadID=%{threadID} conn=%{connectionID} op=%{operationID} msgID=%{messageID} requesterIP=\"%{requesterIP}\" requesterDN=\"%{requesterDN}\" usingAdminSessionWorkerThread=%{usingAdminSessionWorkerThread} requestOID=\"%{requestOID}\" requestType=\"%{requestType}\" resultCode=%{resultCode} resultCodeName=\"%{resultCodeName}\" additionalInfo=\"%{additionalInfo}\" qtime=%{workQueueWaitTimeMillis} etime=%{processingTimeMillis}"}
            remove_field => ["operationType", "messageType", "instanceName", "threadID", "connectionID", "operationID", "messageID", "requesterIP", "requesterDN", "usingAdminSessionWorkerThread", "requestOID", "requestType", "requestCode", "resultCodeName", "additionalInfo", "workQueueWaitTimeMillis", "processingTimeMillis"]
          }
        }
        else if ([messageType] == "RESULT" and [operationType] == "MODIFY") {
          mutate {
            add_field => {"log" => "/opt/pingidentity/server/logs/%{logType} [%{timestamp}] %{operationType} %{messageType} instanceName=\"%{instanceName}\" threadID=%{threadID} conn=%{connectionID} op=%{operationID} msgID=%{messageID} requesterIP=\"%{requesterIP}\" requesterDN=\"%{requesterDN}\" dn=\"%{dn}\" resultCode=%{resultCode} resultCodeName=\"%{resultCodeName}\" etime=%{processingTimeMillis} usedPrivileges=%{usedPrivileges}"}
            remove_field => ["operationType", "messageType", "instanceName", "threadID", "connectionID", "operationID", "messageID", "requesterIP", "requesterDN", "dn", "resultCode", "resultCodeName", "processingTimeMillis", "usedPrivileges"]
          }
        }
        else if ([messageType] == "CONNECT") {
          mutate {
            add_field => {"log" => "/opt/pingidentity/server/logs/%{logType} [%{timestamp}] %{messageType} instanceName=\"%{instanceName}\" threadID=%{threadID} conn=%{connectionID} from=\"%{fromAddress}\" fromPort=%{fromPort} to=\"%{toAddress}\" toPort=%{toPort} protocol=\"%{protocol}\" clientConnectionPolicy=\"%{clientConnectionPolicy}\""}
            remove_field => ["messageType", "instanceName", "threadID", "connectionID", "fromAddress", "fromPort", "toAddress", "toPort", "protocol", "clientConnectionPolicy"]
          }
        }
        else if ([messageType] == "DISCONNECT") {
          mutate {
            add_field => {"log" => "/opt/pingidentity/server/logs/%{logType} [%{timestamp}] %{messageType} requesterIP=\"%{requesterIP}\" instanceName=\"%{instanceName}\" threadID=%{threadID} conn=%{connectionID} reason=\"%{disconnectReason}\""}
            remove_field => ["messageType", "requesterIP", "instanceName", "threadID", "connectionID", "disconnectReason"]
          }
        }
        else if ([messageType] == "SECURITY-NEGOTIATION") {
          mutate {
            add_field => {"log" => "/opt/pingidentity/server/logs/%{logType} [%{timestamp}] %{messageType} requesterIP=\"%{requesterIP}\" instanceName=\"%{instanceName}\" threadID=%{threadID} conn=%{connectionID} protocol=\"%{protocol}\" cipher=\"%{cipher}\" clientServerHandshakeTimeMillis=\"%{clientServerHandshakeTimeMillis}\"  serverOnlyHandshakeTimeMillis=\"%{serverOnlyHandshakeTimeMillis}\""}
            remove_field => ["messageType", "requesterIP", "instanceName", "threadID", "connectionID", "protocol", "cipher", "clientServerHandshakeTimeMillis", "serverOnlyHandshakeTimeMillis"]
          }
        }
      }
      else if ([logType] == "http-operation"){
        mutate {
          add_field => {"log" => "/opt/pingidentity/server/logs/http-detailed-access [%{timestamp}] %{messageType} instanceName=\"%{instanceName}\" threadID=%{threadID} requestID=%{requestID} correlationID=\"%{correlationID}\" from=\"[%{remoteHost}]:%{remotePort}\" method=\"%{requestMethod}\" url=\"%{requestURI}\" requestHeader=\"%{[requestHeader]}\" statusCode=%{statusCode} etime=%{processingTimeMillis} responseContentLength=%{responseContentLength} responseHeader=\"%{responseHeader}\" responseContentType=\"%{responseContentType}\""}
          remove_field => ["messageType", "instanceName", "threadID", "requestID", "correlationID", "remoteHost", "remotePort", "requestMethod", "requestURI", "requestHeader", "statusCode", "processingTimeMillis", "responseContentLength", "responseHeader", "responseContentType"]
        }
      }
      else if ([logType] == "error"){
        if ([category] == "EXTENSIONS" and [severity] == "NOTICE"){
          mutate {
            add_field => {"log" => "/opt/pingidentity/server/logs/errors [%{timestamp}] instanceName=\"%{instanceName}\" threadID=%{threadID} category=%{category} severity=%{severity} msgID=%{messageID} msg=\"%{message}\""}
            remove_field => ["instanceName", "threadID", "category", "severity", "messageID", "message"]
          }
        }
        else if ([category] == "CORE" and [severity] in ["SEVERE_WARNING", "NOTICE"]) {
          mutate {
            add_field => {"log" => "/opt/pingidentity/server/logs/errors [%{timestamp}] category=\"%{category}\" severity=\"%{severity}\" msgID=%{messageID} msg=\"%{message}\""}
            remove_field => ["category", "severity", "messageID", "message"]
          }
        }
        else if ([category] in ["RUNTIME_INFORMATION","CONFIG", "JEB", "REPLICATION", "EXTENSIONS"] and [severity] in ["NOTICE","SEVERE_ERROR"]) {
          mutate {
            add_field => {"log" => "/opt/pingidentity/server/logs/errors [%{timestamp}] instanceName=\"%{instanceName}\" threadID=%{threadID} category=%{category} severity=%{severity} msgID=%{messageID} msg=\"%{message}\""}
            remove_field => ["instanceName", "threadID", "category", "severity", "messageID", "message"]
          }
        }
      }
  }
}