filter {
    if ([kubernetes][container_name] =~ "pingfederate(-admin)?") {
    ### Parse logs starting from log path.
        if ([log] =~ /^\/opt\/out\/instance\/log/) {}
        else
        ### Parse json formatted logs
        {
            json {
                source => "log"
                remove_field => "log"
            }
            if ([log_name] == "admin-api" or [log_name] == "runtime-api") {
              mutate {
                add_field => {"log" => "/opt/out/instance/log/%{log_name} %{timestamp}| %{user}| %{authType}| %{clientIp}| %{httpMethod}| %{url}| %{status}"}
                remove_field => ["user", "authType", "clientIp", "partnerId", "httpMethod", "url", "status"]
              }
            }
            if ([log_name] == "admin-event-detail") {
                mutate {
                    add_field => {"log" => "/opt/out/instance/log/%{log_name} %{eventDetailId} | %{fileName} | %{delta} | %{position} | %{message}"}
                    remove_field => ["eventDetailId", "fileName", "delta", "position", "message"]
                }
            }
            if ([log_name] == "transaction") {
                mutate {
                    add_field => {"log" => "/opt/out/instance/log/%{log_name} %{timestamp} | %{message}"}
                    remove_field => [ "message" ]
                }
            }
            if ([log_name] == "audit") {
                mutate {
                    add_field => {"log" => "/opt/out/instance/log/%{log_name} %{timestamp}| %{trackingId}| %{event}| %{subject}| %{ip} | %{app}| %{connectionId}| %{protocol}| %{host}| %{role}| %{status}| %{adapterId}| %{description}| %{responseTimeMs}"}
                    remove_field => ["trackingId", "transactionId","event", "subject", "ip", "app", "connectionId", "protocol", "host", "role", "status", "adapterId", "description", "responseTimeMs", "policyName", "fragmentName"]
                }
            }
            if ([log_name] == "provisioner-audit") {
                mutate {
                    add_field => {"log" => "/opt/out/instance/log/%{log_name} %{timestamp}| %{cycleId}| %{channelId}| %{eventType}| %{sourceId}| %{targetId}| %{isSuccess}| %{nonSuccessCause}"}
                    remove_field => ["cycleId", "channelId", "eventType", "sourceId", "targetId", "isSuccess", "nonSuccessCause"]
                }
            }
            if ([log_name] == "admin") {
              mutate {
                add_field => {"log" => "/opt/out/instance/log/%{log_name} %{timestamp} | %{user} | %{roles} | %{ip} | %{component} | %{event} | %{eventDetailId} | %{message}"}
                remove_field => ["user", "roles", "ip", "adminSessionId", "component", "event", "eventDetailId", "message"]
              }
            }
            if ([log_name] == "provisioner") {
	          mutate {
	            add_field => {"log" => "/opt/out/instance/log/%{log_name} %{timestamp} %{level} [%{logger}] %{message} %{channelCode}"}
              remove_field => ["level", "cycleId", "channelCode", "logger", "message", "exceptionClassName", "exceptionMessage", "exceptionStackTrace" ]
	          }
            }
            if ([log_name] == "server") {
              mutate {
                add_field => {"log" => "/opt/out/instance/log/%{log_name} %{timestamp} %{trackingId} %{level} [%{logger}] %{message}"}
                remove_field => ["trackingId", "level", "logger", "message", "exceptionClassName", "exceptionMessage", "exceptionStackTrace" ]
              }
            }
        }
    }
}