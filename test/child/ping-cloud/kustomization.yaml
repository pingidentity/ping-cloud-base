kind: Kustomization
apiVersion: kustomize.config.k8s.io/v1beta1

resources:
- ../../ping-cloud

patchesStrategicMerge:

# Overwrite WAIT_FOR_SERVICES as admin exists in primary cluster
- pingfederate/engine-init-env.yaml
- pingaccess/engine-init-env.yaml

# Remove PingAccess parent-related resources
- |-
  apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    name: pingaccess-admin
  $patch: delete

- |-
  apiVersion: v1
  kind: Service
  metadata:
    name: pingaccess-admin
  $patch: delete

- |-
  apiVersion: extensions/v1beta1
  kind: Ingress
  metadata:
    name: pingaccess-admin-ingress
  $patch: delete

- |-
  apiVersion: extensions/v1beta1
  kind: Ingress
  metadata:
    name: pingaccess-cluster-ingress
  $patch: delete

- |-
  apiVersion: v1
  kind: ConfigMap
  metadata:
    name: pingaccess-backup
  $patch: delete

- |-
  apiVersion: batch/v1beta1
  kind: CronJob
  metadata:
    name: pingaccess-periodic-backup
  $patch: delete

# Remove PingFederate parent-related resources
- |-
  apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    name: pingfederate-admin
  $patch: delete

- |-
  apiVersion: v1
  kind: Service
  metadata:
    name: pingfederate-admin
  $patch: delete

- |-
  apiVersion: extensions/v1beta1
  kind: Ingress
  metadata:
    name: pingfederate-admin-ingress
  $patch: delete

- |-
  apiVersion: v1
  kind: ConfigMap
  metadata:
    name: pingfederate-backup
  $patch: delete

- |-
  apiVersion: batch/v1beta1
  kind: CronJob
  metadata:
    name: pingfederate-periodic-backup
  $patch: delete

# Remove PingDirectory parent-related resources

- |-
  apiVersion: v1
  kind: ConfigMap
  metadata:
    name: pingdirectory-backup
  $patch: delete

- |-
  apiVersion: batch/v1beta1
  kind: CronJob
  metadata:
    name: pingdirectory-periodic-backup
  $patch: delete
